% ==========================================
% 1. 论文元信息
% ==========================================
\documentclass[fontset=none, UTF8]{ctexart}
\def\MYTITLEA{请输入你的论文标题}
\def\MYTITLEB{如果太长了可以换行}
\def\MYNAME{738NGX}
\def\MYID{2022114514}
\def\MYCOLLEGE{计算机与人工智能学院}
\def\MYMAJOR{计算机科学与技术}
\def\MYADVISOR{天王寺璃奈}
\def\MYDATE{ \quad 年  \quad \quad 月}
% ==========================================
% 1. 基础宏包与数学支持
% ==========================================
\usepackage{amsmath, amsfonts, amssymb}
\usepackage{graphicx}
\usepackage{xstring}
\usepackage{amssymb} % 用于实现 \checkmark 钩号

% 备份原始命令
\let\oldincludegraphics\includegraphics

% 重定义 \includegraphics 以自动剥离 .png 后缀，如不需要可以注释或删除
\renewcommand{\includegraphics}[2][]{%
    \IfEndWith{#2}{.png}{%
        \StrBefore{#2}{.png}[\filename]% 如果以 .png 结尾，截取前面部分
        \oldincludegraphics[#1]{\filename}%
    }{%
        \oldincludegraphics[#1]{#2}% 如果不是，按原样处理
    }%
}

% 适配某些版本的pandoc转换可能导致的错误
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{%
  \sbox\pandoc@box{#1}%
  \ifdim\wd\pandoc@box>\linewidth
    \resizebox{\linewidth}{!}{\usebox\pandoc@box}%
  \else
    \usebox\pandoc@box
  \fi
}
\makeatother

% 确保 PDF 优先级最高
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{float}
\usepackage{pdfpages}
\usepackage{setspace}
\usepackage{microtype}
\usepackage{booktabs}   % 常用表格线宏包
\usepackage{longtable}  % 支持跨页长表格
\usepackage{array}      % 增强表格功能

% ==========================================
% 2. 字体与中文设置
% ==========================================
\usepackage{xeCJK}

% 基础字体设置
\setmainfont{Times New Roman}
\setCJKmainfont{SIMSUN.TTC}[AutoFakeBold=2.5]
\setsansfont{Arial}
\setCJKsansfont{SIMHEI.TTF}[AutoFakeBold=2.5]
\setCJKmonofont{SIMHEI.TTF}
\setCJKfamilyfont{zhkai}{SIMKAI.TTF}[AutoFakeBold=2.5]
\newcommand{\kaishu}{\CJKfamily{zhkai}}

% ==========================================
% 3. 页面边距与页码格式
% ==========================================
\usepackage[a4paper, top=2.5cm, bottom=2.5cm, left=3cm, right=2cm, footskip=1.0cm]{geometry}
\usepackage{fancyhdr}

\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{{\zihao{-5} 第 \thepage 页}}
    \renewcommand{\headrulewidth}{0pt}
}
\pagestyle{plain}

% ==========================================
% 4. 参考文献 (GB/T 7714-2015)
% ==========================================
\usepackage[
    backend=biber,
    style=gb7714-2015,
    gbalign=left,
    gbpub=false,
    autocite=superscript
]{biblatex}
\addbibresource{sample.bib}

% ==========================================
% 5. 图表格式与编号设置
% ==========================================
\usepackage{caption}
\usepackage{chngcntr}

% 图号格式：图 3-1
\counterwithin{figure}{section}
\renewcommand{\thefigure}{\thesection--\arabic{figure}}
\renewcommand{\figurename}{图}

% 强制图片位置与尺寸限制
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth, height=0.3\textheight, keepaspectratio}

\DeclareGraphicsRule{.png}{pdf}{.pdf}{} % 优先加载同名 pdf
\floatplacement{figure}{H}              % 强制 H 选项

% 自定义图表名格式
\DeclareCaptionFormat{custom}{\kaishu\zihao{5} #1#2#3}
\captionsetup[figure]{
    format=custom,
    labelsep=quad,
    position=bottom,
    font={small}
}
\counterwithin{table}{section}
\renewcommand{\thetable}{\thesection--\arabic{table}}
\renewcommand{\tablename}{表}
\captionsetup[table]{
    format=custom,
    labelsep=quad,
    position=top,
    font={small}
}

% ==========================================
% 6. 章节标题格式 (ctexset)
% ==========================================
\ctexset{
  section = {
    name = {, 、}, 
    number = \chinese{section},
    format = \zihao{3}\sffamily\centering,
    aftername = \hspace{0pt},
    beforeskip = 1ex,
    afterskip = 24pt
  },
  subsection = {
    name = {（, ）},
    number = \chinese{subsection},
    format = \zihao{4}\sffamily\raggedright,
    aftername = \hspace{0pt},
    beforeskip = 1ex,
    afterskip = 12pt
  },
  subsubsection = {
    name = {, },
    number = \arabic{subsubsection}．,
    format = \zihao{5}\sffamily\raggedright,
    aftername = \hspace{0pt},
    beforeskip = 1ex,
    afterskip = 1ex
  }
}

% ==========================================
% 7. 目录格式 (titletoc)
% ==========================================
\usepackage{titletoc}
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}
\renewcommand{\contentsname}{\hfill\zihao{3}\sffamily 目\quad 录\hfill}

\titlecontents{section}
    [0em] {\addvspace{6pt}\zihao{4}\sffamily}
    {\makebox[3em][l]{\thecontentslabel}} {} 
    {\titlerule*[0.5pc]{.}\contentspage}

\titlecontents{subsection}
    [2em] {\addvspace{2pt}\zihao{-4}\sffamily}
    {\makebox[2.5em][l]{\thecontentslabel}} {}
    {\titlerule*[0.5pc]{.}\contentspage}

\titlecontents{subsubsection}
    [4em] {\addvspace{2pt}\zihao{-4}\sffamily}
    {\makebox[2em][l]{\thecontentslabel}} {}
    {\titlerule*[0.5pc]{.}\contentspage}

% ==========================================
% 8. 其他兼容性修正与超链接
% ==========================================
% 解决 Pandoc 的 \tightlist 报错
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
% 超链接设置（最后加载）
\usepackage[unicode=true]{hyperref}
\hypersetup{hidelinks}
% 正文基础字号
\renewcommand{\normalsize}{\zihao{5}}


% ==========================================
% 正文开始
% ==========================================
\begin{document}

% 1. 导入封面
%\includepdf[pages={1,2}]{cover.pdf}
\input{cover}

% 2. 摘要页初始化
\restoregeometry 
\newpage
\pagestyle{plain} 
\pagenumbering{Roman} 
\setcounter{page}{1}

\input{abstract-cn}
\newpage
\input{abstract-en}

\newpage
\tableofcontents 

\newpage
\pagenumbering{arabic} 
\setcounter{page}{1}

\begin{spacing}{1.5}

\input{content}

\end{spacing}

\newpage
\printbibliography[heading=bibintoc, title={参考文献}]

\end{document}